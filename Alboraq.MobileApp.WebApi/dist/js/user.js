!function(e,a){var t={appModal:e("#appModal"),appModalContent:e("#appModal .modal-content"),btnAddUserDialog:e("#btnAddUserDialog"),btnEditUserDialog:e(".btnEditUserDialog"),btnResetPasswordDialog:e(".btnResetPasswordDialog"),btnDeleteUserDialog:e(".btnDeleteUserDialog")};a.init=function(){o()};var n=function(e){e.modaltitle=e.modalTitle||void 0,e.modalSize=e.modalSize||void 0,void 0!==e.modaltitle&&t.appModal.find(".modal-title").text(e.modalTitle),void 0!==e.modalSize&&t.appModal.find(".modal-dialog").addClass(e.modalSize),t.appModal.find(".modal-footer").append('<button id="btnCloseDialog" type="button" class="btn btn-default">Close</button>')},s=function(e){e.button=e.button||void 0,e.innerHTML=e.innerHTML||void 0,e.disabled=e.disabled||!1;var a=t.appModal.find(e.button);void 0!==e.innerHTML&&a.length>0&&a.html(e.innerHTML),e.disabled&&a.length>0?(a.addClass("disabled"),t.appModal.find("#btnCloseDialog").addClass("hidden"),t.appModal.find(".close").addClass("hidden")):(a.removeClass("disabled"),t.appModal.find("#btnCloseDialog").removeClass("hidden"),t.appModal.find(".close").removeClass("hidden"))},d=function(){var a;return(a=t.appModal.find("#alertMessage")).length>0?a.removeClass("alert-success alert-danger").empty():a=e('<div id="alertMessage" class="alert"></div>'),a},o=function(){t.appModal.modal({backdrop:"static",keyboard:!1,show:!1}),t.btnAddUserDialog.on("click",function(){n({modalTitle:"Add new user",modalSize:"modal-sm"});var a=t.appModal.find(".modal-body");a.append('<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x"></i></p>'),a.load("/admin/NewUserPartialView",function(){t.frmNewUser=t.appModalContent.find("#frmNewUser"),t.frmNewUser.validate({rules:{Name:"required",Email:{required:!0,email:!0},Password:{required:!0,minlength:6},ConfirmPassword:{equalTo:"#Password"},PhoneNumber:"required"},messages:{Name:"Please enter your name",Email:"Please enter a valid email address",Password:{required:"Please provide a password",minlength:"The password atleast 6 characters long"},PhoneNumber:"Please enter a mobile number"},submitHandler:function(a){var n=e(a);n.valid()&&n.submit(function(a){a.preventDefault();var n,o=e(a.currentTarget);s({button:"#btnAddSubmit",innerHTML:'Adding new user.. &nbsp; <i class="fa fa-spinner fa-pulse"></i>',disabled:!0}),n=d(),e.ajax({method:"post",url:"/api/account/register",data:o.serialize(),success:function(e){n.addClass("alert-success").append('<p class="text-center">User '+e+" has been created!</p>"),t.appModal.find(".modal-body").prepend(n),t.appModalContent.find("#frmNewUser").find("input").val(""),s({button:"#btnAddSubmit",innerHTML:"Submit",disabled:!1})},error:function(a){var d=a.responseJSON.ModelState[""];e.each(d,function(e,a){n.addClass("alert-danger").append('<p class="text-center">'+a+"</p>")}),t.appModal.find(".modal-body").prepend(n),s({button:"#btnAddSubmit",innerHTML:"Submit",disabled:!1})}})}(event))}})}),t.appModal.modal("show")}),t.appModal.on("shown.bs.modal",function(){e("#Name")&&e("#Name").focus()}),t.appModal.on("hidden.bs.modal",function(){e(this).find(".modal-footer").empty()}),t.appModalContent.on("click","#btnCloseDialog",function(){t.appModal.modal("hide"),location.reload()}),t.btnEditUserDialog.on("click",function(a){var o=e(a.currentTarget).data("userid");n({modalTitle:"Edit user",modalSize:""});var l=t.appModal.find(".modal-body");l.append('<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x"></i></p>'),l.load("/admin/edituserpartialview?userID="+o,function(){t.frmUpdateUser=t.appModalContent.find("#frmUpdateUser"),t.frmUpdateUser.validate({rules:{Name:"required",PhoneNumber:"required"},messages:{Name:"Please enter a name",PhoneNumber:"Please enter a mobile number"},submitHandler:function(a){var n=e(a);n.valid()&&n.submit(function(a){a.preventDefault();var n,o=e(a.currentTarget);s({button:"#btnUpdateUser",innerHTML:'Updating... &nbsp; <i class="fa fa-spinner fa-pulse"></i>',disabled:!0}),n=d(),e.ajax({method:"post",url:"/admin/updateuser",data:o.serialize(),success:function(a){a.isSuccess?(n.addClass("alert-success").append('<p class="text-center">'+a.message+"</p>"),t.appModal.find(".modal-body").prepend(n),s({button:"#btnUpdateUser",innerHTML:"Update",disabled:!1})):(e.each(a.errors,function(e,a){n.addClass("alert-danger").append('<p class="text-center">'+a+"</p>"),s({button:"#btnUpdateUser",innerHTML:"Update",disabled:!1})}),t.appModal.find(".moda-body").prepend(n))},error:function(e){n.add("alert-danger").append('<p class="text-center">'+e.responseText+"</p>")}})}(event))}})}),t.appModal.modal("show")}),t.appModalContent.on("submit","#frmAddUserToRole",function(a){a.preventDefault();var n=e(this);e.ajax({method:"post",url:"/admin/addusertorole",data:n.serialize(),success:function(a){a.isSuccess?(n.find("#addToRoleStatus").text(a.message).addClass("text-success").removeClass("text-danger"),t.appModalContent.find("#tblRoles").append('<tr><td><button type="button" class="btn btn-danger btn-xs btnRemoveRole" data-userid="'+a.userID+'" data-rolename="'+a.roleName+'">Remove</button></td><td>'+a.roleName+"</td></tr>")):e.each(a.errors,function(e,a){n.find("#addToRoleStatus").text(a).addClass("text-danger").removeClass("text-success")})},error:function(e){n.find("#addToRolesStatus").text(e.responseText).addClass("text-danger").removeClass("text-success")}})}),t.appModalContent.on("click",".btnRemoveRole",function(a){var n=e(a.currentTarget),s=n.data("userid"),d=n.data("rolename");e.ajax({method:"post",url:"/admin/removefromrole",contentType:"application/json",data:JSON.stringify({userID:s,roleName:d}),success:function(a){a.isSuccess?(t.appModalContent.find("#removeFromRoleStatus").text(a.message).addClass("text-success").removeClass("text-danger"),n.closest("tr").fadeOut()):e.each(a.errors,function(e,a){t.appModalContent.find("#removeFromRoleStatus").text(a).addClass("text-danger").removeClass("text-success")})},error:function(e){}})}),t.btnResetPasswordDialog.on("click",function(a){var s=e(a.currentTarget).data("email");n({modalTitle:"Reset password",modalSize:'<button id="btnCloseDialog" type="button" class="btn btn-default">Close</button>'});var d=t.appModal.find(".modal-body");d.append('<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x"></i></p>'),d.load("/admin/resetpasswordpartialview?email="+s),t.appModal.modal("show")}),t.appModalContent.on("submit","#frmResetPassword",function(a){a.preventDefault();var n,o=e(this);s({button:"#btnResetPassword",innerHTML:'Resetting the password... &nbsp; <i class="fa fa-spinner fa-pulse"></i>'}),n=d(),e.ajax({method:"post",url:"/admin/resetpassword",data:o.serialize(),success:function(e){n.addClass("alert-success").append('<p class="text-center">'+e.message+"</p>"),t.appModalContent.find(".modal-body").prepend(n),s({button:"#btnResetPassword",innerHTML:"Submit",disabled:!1})},error:function(e){n.addClass("alert-danger").append('<p class="text-center">'+e.responseText+"</p>"),t.appModalContent.find(".modal-body").prepend(n)}})}),t.btnDeleteUserDialog.on("click",function(){var a=e(event.currentTarget).data("email");n({modalTitle:"Delete user",modalSize:"modal-sm"});var s=t.appModal.find(".modal-body");s.append('<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x"></i></p>'),s.load("/admin/deleteuserpartialview?email="+a),t.appModal.modal("show")}),t.appModalContent.on("submit","#frmDeleteUser",function(a){a.preventDefault();var n,o=e(this);s({button:"#btnDeleteUser",innerHTML:'Deleting user... <i class="fa fa-spinner fa-pulse"></i>',disabled:!0}),n=d(),e.ajax({method:"post",url:"/admin/deleteuser",data:o.serialize(),success:function(e){e.isSuccess?n.addClass("alert-success"):n.addClass("alert-danger"),n.append('<p class="text-center">'+e.message+"</p>"),t.appModal.find(".modal-body").empty().prepend(n),s({button:"#btnDeleteUser",innerHTML:"Submit",disabled:!1})},error:function(e){n.addClass("alert-danger").append('<p class="text-center">'+response.responseText+"</p>"),t.appModal.find(".modal-body").prepend(n),s({button:"#btnDeleteUser",innerHTML:"Submit",disabled:!1})}})})}}(jQuery,window.UserWidget=window.UserWidget||{}),UserWidget.init();